
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Water Quality, Perception and Knowledge in China &#8212; Will&#39;s Thesis</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Methodology" href="methodology.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Will's Thesis</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="literature-review.html">
   Literature Review
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="methodology.html">
   Methodology
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Water Quality, Perception and Knowledge in China
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/thesis_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/thesis_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#master-s-thesis-data-for-tsinghua-university">
   Master’s thesis data for Tsinghua University
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data">
   Load Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#china-general-social-survey-2010">
     1. China General Social Survey (2010)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#general-demographics">
       General Demographics
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#environmental-module-part-l">
       Environmental Module (Part L)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#very-limited-subset-of-questions-for-initial-analysis">
       Very Limited Subset of Questions (for initial analysis)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#blue-city-water-quality-index-ranking">
     2. 2018 Blue City Water Quality Index Ranking
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-data-exploration">
   Initial Data Exploration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cgss2010">
     CGSS2010
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#heatmap-function">
       Heatmap Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#count-function">
       Count Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#percent-function">
       Percent Function
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#individual-question-countplot">
       Individual Question Countplot
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#blue-city-water-quality-index-ranking-visualization-wqir2018">
     2018 Blue City Water Quality Index Ranking Visualization (WQIR2018)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-data">
   Combining Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sorting-data">
   Sorting Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l14d">
     <code class="docutils literal notranslate">
      <span class="pre">
       l14d
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l2409">
     <code class="docutils literal notranslate">
      <span class="pre">
       l2409
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#if-i-filter-out-8-then-ningxia-province-get-s-taken-out-find-a-fix">
   <strong>
    If I filter out 8, then Ningxia province get’s taken out… find a fix
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-data">
     Merge Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#individual-data-analysis">
   Individual Data Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#initial-findings">
     Initial Findings
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-for-divergence">
       Test for divergence
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="water-quality-perception-and-knowledge-in-china">
<h1>Water Quality, Perception and Knowledge in China<a class="headerlink" href="#water-quality-perception-and-knowledge-in-china" title="Permalink to this headline">¶</a></h1>
<div class="section" id="master-s-thesis-data-for-tsinghua-university">
<h2>Master’s thesis data for Tsinghua University<a class="headerlink" href="#master-s-thesis-data-for-tsinghua-university" title="Permalink to this headline">¶</a></h2>
<p>This document is the data analysis of water quality, water quality perception, and water quality knowledge in China. The analysis is driven primarily by two datasets - water quality (2017, per prefecture) and a national general social survey (China General Social Survey, 2010) with an environmental module.</p>
<p>Several questions are examined:</p>
<ul class="simple">
<li><p>How do peoples perception of water quality (importance, status, severity, their knowledge, etc) align with actual water quality?</p></li>
<li><p>Is there a correlation between water quality and perception of water quality? (I.e. do perceptions and reality match)?</p></li>
<li><p>Does knowledge of water quality affect perception?</p></li>
<li><p>Does general education affect perception?</p></li>
</ul>
<p>This document show the progression of analysis, thus not all cells and text are relevant to the final findings of this thesis.</p>
<div class="alert alert-block alert-info">
<b>Note:</b> Work in progress (Jan 31, 2021).</div></div>
<hr class="docutils" />
<div class="section" id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="#Load-Data">Load Data</a><br />
<a class="reference external" href="#Initial-Data-Exploration">Initial Data Exploration</a><br />
<a class="reference external" href="#Combining-Data">Combining Data</a><br />
<a class="reference external" href="#Individual-Data-Analysis">Individual Data Analysis</a></p>
</div>
<hr class="docutils" />
<div class="section" id="load-data">
<h2>Load Data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">statsmodels</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">statsmodels.multivariate.manova</span> <span class="kn">import</span> <span class="n">MANOVA</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns ALL columns when displaying DataFrame, useful for finding column names</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="china-general-social-survey-2010">
<h3>1. China General Social Survey (2010)<a class="headerlink" href="#china-general-social-survey-2010" title="Permalink to this headline">¶</a></h3>
<p>The first dataset is the China General Social Survey (CGSS), an annual national comprehensive survey consisting of demographic data, social indicators, and rotating modules. The year 2010 is used since it is the latest published which includes the environmental module, 20+ questions about quality of the environment, peoples’ thoughts on the importance of the environment, the severity of environmental degredation, etc. (more details below).</p>
<p>http://cgss.ruc.edu.cn/index.php?r=index/index&amp;hl=en</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load cgss2010 Stata file, display the first 5 rows (.head())</span>
<span class="n">cgss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="s1">&#39;../data/cgss2010_12.dta&#39;</span><span class="p">,</span> <span class="n">convert_categoricals</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cgss</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 11783 entries, 0 to 11782
Columns: 871 entries, id to dataversion
dtypes: float32(64), float64(576), int16(16), int8(215)
memory usage: 57.5 MB
</pre></div>
</div>
</div>
</div>
<div class="section" id="general-demographics">
<h4>General Demographics<a class="headerlink" href="#general-demographics" title="Permalink to this headline">¶</a></h4>
<p>s41 - province codes</p>
<p>a2 - gender</p>
<p>a3a - birth year</p>
<p>a3b - birth month</p>
<p>a3c - birth date</p>
<p>a7a - highest current level of education</p>
<p>a8a - personal total income</p>
<p>a15 - subjective physical health</p>
<p>a62 - family total income (2009)</p>
<p>a91 - rural / agricultural household <em>(1=yes, 2=no)</em></p>
<p>a92 - rural / agricultural household <em>(1=yes, 2=no) (verified by surveyor)</em></p>
</div>
<div class="section" id="environmental-module-part-l">
<h4>Environmental Module (Part L)<a class="headerlink" href="#environmental-module-part-l" title="Permalink to this headline">¶</a></h4>
<p>l1a - “In your opinion, in terms of the current situation in our country, which of the following issues is the most important?” <strong>(4 = environment)</strong></p>
<p>l1b - <em>like l1a, but 2nd most important</em></p>
<p>l6a - “In your opinion, in terms of the current situation in our country, which of the following issues is the most important?” <em>(1 = not at all, 5 = very concerned)</em></p>
<p>l6b - How serious are env. problems facing China? <em>(1 = very, 5 = not at all)</em></p>
<p>l7a - Which is most important env. issue in China? <strong>(4 = water pollution)</strong></p>
<p>l7b - Which has greatest impact on you/family? <strong>(4 = water pollution)</strong></p>
<p>l8a - Knowledge of causes of environmental problems from ?l7</p>
<p>l8b - Knowledge of solutions of environmental problems from ?l7</p>
<p>l12a - “In order to protect the environment, to what extent are you willing to pay a higher price?” <em>(1 = very willing, 5 = very reluctant)</em></p>
<p>l12b - <em>like l12a, but with higher taxes</em></p>
<p>l12c - like l12a/b, but with willingness to lower living standards</p>
<p>l137 - “Environmental issues directly affect my daily life” <em>(1 = disagree, 5 = agree)</em></p>
<p>l14d - “How do you think the pollution of rivers, rivers and lakes in China is harmful to the environment?” <em>(1 = extremely, 5 = not at all)</em></p>
<p>l15a/b - <em>see question, about statements of responsibility for environmental protection (individuals/companies, government, etc.)</em></p>
<p>l16c - “In terms of solving environmental problems in your area, how do you think the local government has done in the past five years?” <em>(1 = ignored, 5 = successful)</em></p>
<p>l20e - “Do you often save water or reuse water specifically for environmental protection?” <em>(1 = always, 4 = never)</em></p>
<p>l2409 - “In the domestic water pollution report, the water quality of Category V (5) is better than that of Category I (1)” <em>(1 = correct, 2 = incorrect, 8 = cannot choose)</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">important_questions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;a2&#39;</span><span class="p">,</span><span class="s1">&#39;a3a&#39;</span><span class="p">,</span><span class="s1">&#39;a3b&#39;</span><span class="p">,</span><span class="s1">&#39;a3c&#39;</span><span class="p">,</span><span class="s1">&#39;a7a&#39;</span><span class="p">,</span><span class="s1">&#39;a8a&#39;</span><span class="p">,</span><span class="s1">&#39;a15&#39;</span><span class="p">,</span><span class="s1">&#39;a62&#39;</span><span class="p">,</span><span class="s1">&#39;a91&#39;</span><span class="p">,</span><span class="s1">&#39;a92&#39;</span><span class="p">,</span><span class="s1">&#39;l1a&#39;</span><span class="p">,</span><span class="s1">&#39;l1b&#39;</span><span class="p">,</span><span class="s1">&#39;l6a&#39;</span><span class="p">,</span><span class="s1">&#39;l7a&#39;</span><span class="p">,</span><span class="s1">&#39;l7b&#39;</span><span class="p">,</span><span class="s1">&#39;l8a&#39;</span><span class="p">,</span><span class="s1">&#39;l8b&#39;</span><span class="p">,</span><span class="s1">&#39;l12a&#39;</span><span class="p">,</span><span class="s1">&#39;l12b&#39;</span><span class="p">,</span><span class="s1">&#39;l12c&#39;</span><span class="p">,</span><span class="s1">&#39;l137&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span><span class="s1">&#39;l15a&#39;</span><span class="p">,</span><span class="s1">&#39;l15b&#39;</span><span class="p">,</span><span class="s1">&#39;l16c&#39;</span><span class="p">,</span><span class="s1">&#39;l20e&#39;</span><span class="p">,</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Below is a subset of only important questions from the environmental module (including and omitting<code class="docutils literal notranslate"><span class="pre">s41</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">environment</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;l1a&#39;</span><span class="p">,</span><span class="s1">&#39;l1b&#39;</span><span class="p">,</span><span class="s1">&#39;l6a&#39;</span><span class="p">,</span><span class="s1">&#39;l7a&#39;</span><span class="p">,</span><span class="s1">&#39;l7b&#39;</span><span class="p">,</span><span class="s1">&#39;l8a&#39;</span><span class="p">,</span><span class="s1">&#39;l8b&#39;</span><span class="p">,</span><span class="s1">&#39;l12a&#39;</span><span class="p">,</span><span class="s1">&#39;l12b&#39;</span><span class="p">,</span><span class="s1">&#39;l12c&#39;</span><span class="p">,</span><span class="s1">&#39;l137&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span><span class="s1">&#39;l15a&#39;</span><span class="p">,</span><span class="s1">&#39;l15b&#39;</span><span class="p">,</span><span class="s1">&#39;l16c&#39;</span><span class="p">,</span><span class="s1">&#39;l20e&#39;</span><span class="p">,</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">part_l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;l1a&#39;</span><span class="p">,</span><span class="s1">&#39;l1b&#39;</span><span class="p">,</span><span class="s1">&#39;l6a&#39;</span><span class="p">,</span><span class="s1">&#39;l7a&#39;</span><span class="p">,</span><span class="s1">&#39;l7b&#39;</span><span class="p">,</span><span class="s1">&#39;l8a&#39;</span><span class="p">,</span><span class="s1">&#39;l8b&#39;</span><span class="p">,</span><span class="s1">&#39;l12a&#39;</span><span class="p">,</span><span class="s1">&#39;l12b&#39;</span><span class="p">,</span><span class="s1">&#39;l12c&#39;</span><span class="p">,</span><span class="s1">&#39;l137&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span><span class="s1">&#39;l15a&#39;</span><span class="p">,</span><span class="s1">&#39;l15b&#39;</span><span class="p">,</span><span class="s1">&#39;l16c&#39;</span><span class="p">,</span><span class="s1">&#39;l20e&#39;</span><span class="p">,</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><em>For some reason, I need to manually copy the list of important column codes. They are the same as the <code class="docutils literal notranslate"><span class="pre">important</span> <span class="pre">questions</span></code> above.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_important</span> <span class="o">=</span> <span class="n">cgss</span><span class="p">[[</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;a2&#39;</span><span class="p">,</span><span class="s1">&#39;a3a&#39;</span><span class="p">,</span><span class="s1">&#39;a3b&#39;</span><span class="p">,</span><span class="s1">&#39;a3c&#39;</span><span class="p">,</span><span class="s1">&#39;a7a&#39;</span><span class="p">,</span><span class="s1">&#39;a8a&#39;</span><span class="p">,</span><span class="s1">&#39;a15&#39;</span><span class="p">,</span><span class="s1">&#39;a62&#39;</span><span class="p">,</span><span class="s1">&#39;a91&#39;</span><span class="p">,</span><span class="s1">&#39;a92&#39;</span><span class="p">,</span><span class="s1">&#39;l1a&#39;</span><span class="p">,</span><span class="s1">&#39;l1b&#39;</span><span class="p">,</span><span class="s1">&#39;l6a&#39;</span><span class="p">,</span><span class="s1">&#39;l7a&#39;</span><span class="p">,</span><span class="s1">&#39;l7b&#39;</span><span class="p">,</span><span class="s1">&#39;l8a&#39;</span><span class="p">,</span><span class="s1">&#39;l8b&#39;</span><span class="p">,</span><span class="s1">&#39;l12a&#39;</span><span class="p">,</span><span class="s1">&#39;l12b&#39;</span><span class="p">,</span><span class="s1">&#39;l12c&#39;</span><span class="p">,</span><span class="s1">&#39;l137&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span><span class="s1">&#39;l15a&#39;</span><span class="p">,</span><span class="s1">&#39;l15b&#39;</span><span class="p">,</span><span class="s1">&#39;l16c&#39;</span><span class="p">,</span><span class="s1">&#39;l20e&#39;</span><span class="p">,</span><span class="s1">&#39;l2409&#39;</span><span class="p">]]</span>
<span class="n">cgss_important</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>s41</th>
      <th>a2</th>
      <th>a3a</th>
      <th>a3b</th>
      <th>a3c</th>
      <th>a7a</th>
      <th>a8a</th>
      <th>a15</th>
      <th>a62</th>
      <th>a91</th>
      <th>a92</th>
      <th>l1a</th>
      <th>l1b</th>
      <th>l6a</th>
      <th>l7a</th>
      <th>l7b</th>
      <th>l8a</th>
      <th>l8b</th>
      <th>l12a</th>
      <th>l12b</th>
      <th>l12c</th>
      <th>l137</th>
      <th>l14d</th>
      <th>l15a</th>
      <th>l15b</th>
      <th>l16c</th>
      <th>l20e</th>
      <th>l2409</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>11783.000000</td>
      <td>11783.000000</td>
      <td>11783.000000</td>
      <td>11783.000000</td>
      <td>11783.000000</td>
      <td>11783.000000</td>
      <td>11783.000</td>
      <td>11783.000000</td>
      <td>11783.00</td>
      <td>11782.000000</td>
      <td>6694.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
      <td>3672.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>15.366205</td>
      <td>1.518204</td>
      <td>1962.196809</td>
      <td>6.590512</td>
      <td>14.806331</td>
      <td>4.840703</td>
      <td>1395715.625</td>
      <td>3.606891</td>
      <td>1266528.50</td>
      <td>1.565948</td>
      <td>1.898267</td>
      <td>9.581155</td>
      <td>10.884532</td>
      <td>3.720316</td>
      <td>14.029956</td>
      <td>13.319989</td>
      <td>2.920752</td>
      <td>2.583333</td>
      <td>3.280229</td>
      <td>3.543028</td>
      <td>3.572440</td>
      <td>3.820534</td>
      <td>2.913943</td>
      <td>3.227669</td>
      <td>3.192810</td>
      <td>3.463780</td>
      <td>2.482026</td>
      <td>6.352397</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.865554</td>
      <td>0.499690</td>
      <td>35.062692</td>
      <td>3.472828</td>
      <td>8.585052</td>
      <td>2.998698</td>
      <td>3442447.500</td>
      <td>1.139152</td>
      <td>3271839.25</td>
      <td>0.504143</td>
      <td>0.396405</td>
      <td>23.114167</td>
      <td>25.581364</td>
      <td>1.133402</td>
      <td>29.785397</td>
      <td>28.256381</td>
      <td>1.539628</td>
      <td>1.583291</td>
      <td>1.863691</td>
      <td>1.877130</td>
      <td>1.766908</td>
      <td>1.606539</td>
      <td>1.994326</td>
      <td>2.708164</td>
      <td>2.632461</td>
      <td>2.159607</td>
      <td>1.031619</td>
      <td>2.881289</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>0.000</td>
      <td>-3.000000</td>
      <td>0.00</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>7.000000</td>
      <td>1.000000</td>
      <td>1952.000000</td>
      <td>3.000000</td>
      <td>8.000000</td>
      <td>3.000000</td>
      <td>4000.000</td>
      <td>3.000000</td>
      <td>15000.00</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>15.000000</td>
      <td>2.000000</td>
      <td>1964.000000</td>
      <td>7.000000</td>
      <td>15.000000</td>
      <td>4.000000</td>
      <td>12000.000</td>
      <td>4.000000</td>
      <td>30000.00</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>22.000000</td>
      <td>2.000000</td>
      <td>1974.000000</td>
      <td>10.000000</td>
      <td>22.000000</td>
      <td>6.000000</td>
      <td>30000.000</td>
      <td>4.000000</td>
      <td>61104.00</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>4.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>4.000000</td>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>4.000000</td>
      <td>3.000000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>31.000000</td>
      <td>2.000000</td>
      <td>1993.000000</td>
      <td>12.000000</td>
      <td>31.000000</td>
      <td>14.000000</td>
      <td>9999999.000</td>
      <td>5.000000</td>
      <td>9999999.00</td>
      <td>2.000000</td>
      <td>2.000000</td>
      <td>98.000000</td>
      <td>98.000000</td>
      <td>8.000000</td>
      <td>98.000000</td>
      <td>98.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>8.000000</td>
      <td>4.000000</td>
      <td>8.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="very-limited-subset-of-questions-for-initial-analysis">
<h4>Very Limited Subset of Questions (for initial analysis)<a class="headerlink" href="#very-limited-subset-of-questions-for-initial-analysis" title="Permalink to this headline">¶</a></h4>
<p>This only includes the most important questions,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns_strict</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span> <span class="o">=</span> <span class="n">cgss</span><span class="p">[</span><span class="n">columns_strict</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Only include the strict set of 3 columns</p>
<p>The survey uses geographic identifiers in columns s41 (and I think s42-44). However, only province level information is released, due to privacy concerns (see <a class="reference external" href="http://cgss.ruc.edu.cn/index.php?r=index/artabout&amp;aid=18">this link</a>). They are listed below, in a dictionary (Chinese)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">provinces</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;prov.csv&#39;</span><span class="p">)</span>
<span class="n">provinces</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>province_full</th>
      <th>province</th>
      <th>province_en</th>
    </tr>
    <tr>
      <th>s41</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>上海市</td>
      <td>上海</td>
      <td>Shanghai</td>
    </tr>
    <tr>
      <th>2</th>
      <td>云南省</td>
      <td>云南</td>
      <td>Yunnan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>内蒙古自治区</td>
      <td>内蒙古</td>
      <td>Inner Mongolia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>北京市</td>
      <td>北京</td>
      <td>Beijing</td>
    </tr>
    <tr>
      <th>5</th>
      <td>吉林省</td>
      <td>吉林</td>
      <td>Jilin</td>
    </tr>
    <tr>
      <th>6</th>
      <td>四川省</td>
      <td>四川</td>
      <td>Sichuan</td>
    </tr>
    <tr>
      <th>7</th>
      <td>天津市</td>
      <td>天津</td>
      <td>Tianjin</td>
    </tr>
    <tr>
      <th>8</th>
      <td>宁夏回族自治区</td>
      <td>宁夏</td>
      <td>Ningxia</td>
    </tr>
    <tr>
      <th>9</th>
      <td>安徽省</td>
      <td>安徽</td>
      <td>Anhui</td>
    </tr>
    <tr>
      <th>10</th>
      <td>山东省</td>
      <td>山东</td>
      <td>Shandong</td>
    </tr>
    <tr>
      <th>11</th>
      <td>山西省</td>
      <td>山西</td>
      <td>Shanxi</td>
    </tr>
    <tr>
      <th>12</th>
      <td>广东省</td>
      <td>广东</td>
      <td>Guangdong</td>
    </tr>
    <tr>
      <th>13</th>
      <td>广西壮族自治区</td>
      <td>广西</td>
      <td>Guangxi</td>
    </tr>
    <tr>
      <th>14</th>
      <td>新疆维吾尔自治区</td>
      <td>新疆</td>
      <td>Xinjiang</td>
    </tr>
    <tr>
      <th>15</th>
      <td>江苏省</td>
      <td>江苏</td>
      <td>Jiangsu</td>
    </tr>
    <tr>
      <th>16</th>
      <td>江西省</td>
      <td>江西</td>
      <td>Jiangxi</td>
    </tr>
    <tr>
      <th>17</th>
      <td>河北省</td>
      <td>河北</td>
      <td>Hebei</td>
    </tr>
    <tr>
      <th>18</th>
      <td>河南省</td>
      <td>河南</td>
      <td>Henan</td>
    </tr>
    <tr>
      <th>19</th>
      <td>浙江省</td>
      <td>浙江</td>
      <td>Zhejiang</td>
    </tr>
    <tr>
      <th>20</th>
      <td>海南省</td>
      <td>海南</td>
      <td>Hainan</td>
    </tr>
    <tr>
      <th>21</th>
      <td>湖北省</td>
      <td>湖北</td>
      <td>Hubei</td>
    </tr>
    <tr>
      <th>22</th>
      <td>湖南省</td>
      <td>湖南</td>
      <td>Hunan</td>
    </tr>
    <tr>
      <th>23</th>
      <td>甘肃省</td>
      <td>甘肃</td>
      <td>Gansu</td>
    </tr>
    <tr>
      <th>24</th>
      <td>福建省</td>
      <td>福建</td>
      <td>Fujian</td>
    </tr>
    <tr>
      <th>25</th>
      <td>西藏自治区</td>
      <td>西藏</td>
      <td>Tibet</td>
    </tr>
    <tr>
      <th>26</th>
      <td>贵州省</td>
      <td>贵州</td>
      <td>Guizhou</td>
    </tr>
    <tr>
      <th>27</th>
      <td>辽宁省</td>
      <td>辽宁</td>
      <td>Liaoning</td>
    </tr>
    <tr>
      <th>28</th>
      <td>重庆市</td>
      <td>重庆</td>
      <td>Chongqing</td>
    </tr>
    <tr>
      <th>29</th>
      <td>陕西省</td>
      <td>陕西</td>
      <td>Shaanxi</td>
    </tr>
    <tr>
      <th>30</th>
      <td>青海省</td>
      <td>青海</td>
      <td>Qinghai</td>
    </tr>
    <tr>
      <th>31</th>
      <td>黑龙江省</td>
      <td>黑龙江</td>
      <td>Heilongjiang</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="blue-city-water-quality-index-ranking">
<h3>2. 2018 Blue City Water Quality Index Ranking<a class="headerlink" href="#blue-city-water-quality-index-ranking" title="Permalink to this headline">¶</a></h3>
<p>The second dataset is the water quality of every prefecture (sub-province) from a 2018 publication (using 2017 measurements). <strong>Add more details</strong></p>
<p>https://wwwoa.ipe.org.cn//Upload/201909201147459274.pdf (en)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wqir</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/wqir2018_zh.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">province</span> <span class="o">=</span> <span class="n">wqir</span><span class="p">[</span><span class="s1">&#39;province&#39;</span><span class="p">]</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">wqir</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>
<span class="n">city</span> <span class="o">=</span> <span class="n">wqir</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">]</span>
<span class="n">category</span> <span class="o">=</span> <span class="n">wqir</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="initial-data-exploration">
<h2>Initial Data Exploration<a class="headerlink" href="#initial-data-exploration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cgss2010">
<h3>CGSS2010<a class="headerlink" href="#cgss2010" title="Permalink to this headline">¶</a></h3>
<div class="section" id="heatmap-function">
<h4>Heatmap Function<a class="headerlink" href="#heatmap-function" title="Permalink to this headline">¶</a></h4>
<p>The following function asks the user to imput a column title (question code). Any column name can be entered, but for interesting results, choose one from the above list of important survey questions.</p>
<p>Once the column name is entered, the function displays a visual heatmap of the response types by decimal (total = 1.0) on the x axis, sorted by province on the y axis.</p>
<p>Enter <code class="docutils literal notranslate"><span class="pre">heatmap()</span></code> to execute this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heatmap</span><span class="p">():</span>
    <span class="n">user_column</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a column code: &#39;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">cgss</span><span class="p">[</span><span class="n">cgss</span><span class="p">[</span><span class="n">user_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Group by provence, count people in each province, then sort them by asceding order.</span>
    <span class="n">user_grouped</span> <span class="o">=</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span> <span class="n">user_column</span><span class="p">])</span>
        <span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">user_grouped_percent</span><span class="o">=</span><span class="n">user_grouped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s41&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">user_grouped_percent</span><span class="o">=</span><span class="n">user_grouped_percent</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span>
        <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="s1">&#39;AR PL UMing CN&#39;</span><span class="p">,</span>
        <span class="n">font_scale</span><span class="o">=.</span><span class="mi">30</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">user_grouped_percent</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
        <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">user_column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="count-function">
<h4>Count Function<a class="headerlink" href="#count-function" title="Permalink to this headline">¶</a></h4>
<p>The following function does the same initial steps as the <code class="docutils literal notranslate"><span class="pre">heatmap</span></code> function, but without normalizing by the number of responses per province (it only sums the responses by type and by province).</p>
<p>Enter <code class="docutils literal notranslate"><span class="pre">count()</span></code> to execute this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count</span><span class="p">():</span>
    <span class="n">user_column</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a column code: &#39;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">cgss</span><span class="p">[</span><span class="n">cgss</span><span class="p">[</span><span class="n">user_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">user_grouped</span> <span class="o">=</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span> <span class="n">user_column</span><span class="p">])</span>
        <span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">user_grouped</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="percent-function">
<h4>Percent Function<a class="headerlink" href="#percent-function" title="Permalink to this headline">¶</a></h4>
<p>The following function is the same as the <code class="docutils literal notranslate"><span class="pre">count</span></code> function, but also normalizes per province to make quanities comparable. It’s essentially the <code class="docutils literal notranslate"><span class="pre">heatmap</span></code> function without the visualization.</p>
<p>Enter <code class="docutils literal notranslate"><span class="pre">percent()</span></code> to execute this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">percent</span><span class="p">():</span>
    <span class="n">user_column</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a column code: &#39;</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">cgss</span><span class="p">[</span><span class="n">cgss</span><span class="p">[</span><span class="n">user_column</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">user_grouped</span> <span class="o">=</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span> <span class="n">user_column</span><span class="p">])</span>
        <span class="o">.</span><span class="n">size</span><span class="p">()</span>
        <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">user_grouped_percent</span><span class="o">=</span><span class="n">user_grouped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;s41&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">user_grouped_percent</span><span class="o">=</span><span class="n">user_grouped_percent</span>
    <span class="n">user_grouped_percent</span><span class="o">=</span><span class="n">user_grouped_percent</span>
    <span class="k">return</span> <span class="n">user_grouped_percent</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="individual-question-countplot">
<h4>Individual Question Countplot<a class="headerlink" href="#individual-question-countplot" title="Permalink to this headline">¶</a></h4>
<p>The following function visualizes number of responses (total, not per province) for each response type of an entered column (question code).</p>
<p>Enter <code class="docutils literal notranslate"><span class="pre">countplot()</span></code> to execute this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">countplot</span><span class="p">():</span>
    <span class="n">user_column</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a column code: &#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">cgss</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">cgss</span><span class="p">[</span><span class="n">user_column</span><span class="p">],</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="blue-city-water-quality-index-ranking-visualization-wqir2018">
<h3>2018 Blue City Water Quality Index Ranking Visualization (WQIR2018)<a class="headerlink" href="#blue-city-water-quality-index-ranking-visualization-wqir2018" title="Permalink to this headline">¶</a></h3>
<p>The following shows statististical information for the WQIR2018 dataset. Let’s see the data, loaded above. As evident, the <code class="docutils literal notranslate"><span class="pre">Province</span></code>, <code class="docutils literal notranslate"><span class="pre">City</span></code>, <code class="docutils literal notranslate"><span class="pre">Score</span></code>, <code class="docutils literal notranslate"><span class="pre">Rank</span></code>, and the <code class="docutils literal notranslate"><span class="pre">Level</span></code> for the water quality level.</p>
<p><em>Run <code class="docutils literal notranslate"><span class="pre">wqir.head()</span></code> to see the shape of the dataframe</em></p>
<p>On page 5 of the report <a class="reference external" href="https://wwwoa.ipe.org.cn//Upload/201909201147459274.pdf">here</a> (mentioned above), the following are the score/level to water quality classes (outlined <a class="reference external" href="http://english.mee.gov.cn/SOE/soechina1997/water/standard.htm">here</a>):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>IPE Score</p></th>
<th class="text-align:center head"><p>IPE Level (EN)</p></th>
<th class="text-align:center head"><p>IPE Level (ZH)</p></th>
<th class="text-align:center head"><p>EQ  Water</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>0.00 - 4.79</p></td>
<td class="text-align:center"><p>Excellent</p></td>
<td class="text-align:center"><p>优</p></td>
<td class="text-align:center"><p>II</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>4.79 - 10.28</p></td>
<td class="text-align:center"><p>Good</p></td>
<td class="text-align:center"><p>良</p></td>
<td class="text-align:center"><p>III</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>10.28 - 16.85</p></td>
<td class="text-align:center"><p>Moderate</p></td>
<td class="text-align:center"><p>一般</p></td>
<td class="text-align:center"><p>IV</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>16.85 - 24.74</p></td>
<td class="text-align:center"><p>Relatively Poor</p></td>
<td class="text-align:center"><p>较差</p></td>
<td class="text-align:center"><p>V</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>24.70 - 50.00</p></td>
<td class="text-align:center"><p>Poor</p></td>
<td class="text-align:center"><p>差</p></td>
<td class="text-align:center"><p>V</p></td>
</tr>
</tbody>
</table>
<p><em>Note: The EQ equivalents above refer “The total score (equivalent to the local water
quality average) met or surpassed the requirements of Class <code class="docutils literal notranslate"><span class="pre">X</span></code> (II-V) water quality…”</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wqir_mean</span> <span class="o">=</span> <span class="n">wqir</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;province&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following plot visualizes the WQIR2018 values by province (y axis), with each prefecture’s score lined up on the x axis. This is to visualize the range of water quality values in each province. On the top and right, two histograms count the occurances at each value (horizontal, top one bins water quality scores, while the vertical, right one bins the number of prefecture regions per province).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="s1">&#39;AR PL UMing CN&#39;</span><span class="p">,</span>
    <span class="n">font_scale</span><span class="o">=.</span><span class="mi">85</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">JointGrid</span><span class="p">(</span>
    <span class="n">ratio</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">space</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">marginal_ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">45</span><span class="p">),</span>
    <span class="n">x</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">province</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;gist_earth&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">wqir</span><span class="p">,</span>
<span class="p">)</span> 
  
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">,</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.JointGrid at 0x7f7be287c310&gt;
</pre></div>
</div>
<img alt="_images/thesis_analysis_53_1.png" src="_images/thesis_analysis_53_1.png" />
</div>
</div>
<p>The provinces of 青海 (Qinghai), 海南 (Hainan), and 西藏 (Tibet) have good water quality which is relatively uniform. These make for good comparison with provinces with worse water quality.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="combining-data">
<h2>Combining Data<a class="headerlink" href="#combining-data" title="Permalink to this headline">¶</a></h2>
<p>In this section, I will try to link the data from CGSS2010 and WQIR2018 and compare them across provinces.</p>
</div>
<div class="section" id="sorting-data">
<h2>Sorting Data<a class="headerlink" href="#sorting-data" title="Permalink to this headline">¶</a></h2>
<p>This section has the data loaded previously sorted, usually by province.</p>
<p>First, count the values of the <code class="docutils literal notranslate"><span class="pre">cgss_strict</span></code> df (so it’s easier to deal with and understand) by province <code class="docutils literal notranslate"><span class="pre">s41</span></code>. I learned this <a class="reference external" href="https://kanoki.org/2020/03/09/how-to-use-pandas-count-and-value_counts/">here</a>.</p>
<p><em>Run <code class="docutils literal notranslate"><span class="pre">cgss_strict.groupby(by='s41').agg('count')</span></code> to see the number of responses per province</em></p>
<div class="section" id="l14d">
<h3><code class="docutils literal notranslate"><span class="pre">l14d</span></code><a class="headerlink" href="#l14d" title="Permalink to this headline">¶</a></h3>
<p>Sort by response types for <code class="docutils literal notranslate"><span class="pre">l14d</span></code>, see the number of responses. Column <code class="docutils literal notranslate"><span class="pre">s41</span></code> is irrelavent, this is just to see all response types for <code class="docutils literal notranslate"><span class="pre">l14d</span></code> to check for incorrect values.</p>
<p>Call one column <code class="docutils literal notranslate"><span class="pre">l14d</span></code>, then count instances of values with <code class="docutils literal notranslate"><span class="pre">.value_counts()</span></code>, then make a dataframe with <code class="docutils literal notranslate"><span class="pre">.to_frame()</span></code>, then sort by the response value with <code class="docutils literal notranslate"><span class="pre">.sort_index()</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span><span class="p">[</span><span class="s1">&#39;l14d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>l14d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-3.0</th>
      <td>6</td>
    </tr>
    <tr>
      <th>-2.0</th>
      <td>11</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>565</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>1429</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>972</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>250</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>37</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>402</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As we can see, there are negative values, which are not valid response types. Let’s see which provinces they’re in, to see if we can safely drop the values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span><span class="p">[</span><span class="n">cgss_strict</span><span class="p">[</span><span class="s1">&#39;l14d&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>l14d</th>
      <th>l2409</th>
    </tr>
    <tr>
      <th>s41</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>22.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>25.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="l2409">
<h3><code class="docutils literal notranslate"><span class="pre">l2409</span></code><a class="headerlink" href="#l2409" title="Permalink to this headline">¶</a></h3>
<p>repeat</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span><span class="p">[</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>l2409</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-3.0</th>
      <td>25</td>
    </tr>
    <tr>
      <th>-2.0</th>
      <td>19</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>287</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>596</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>2745</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span><span class="p">[</span><span class="n">cgss_strict</span><span class="p">[</span><span class="s1">&#39;l2409&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>l14d</th>
      <th>l2409</th>
    </tr>
    <tr>
      <th>s41</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>25.0</th>
      <td>17</td>
      <td>17</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>4</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<hr class="docutils" />
<p>For the first question <code class="docutils literal notranslate"><span class="pre">l14d</span></code>, the negative values are fairly spread out between columns. It’s safe to drop them.</p>
<p>However, for <code class="docutils literal notranslate"><span class="pre">l2409</span></code>, they make up a large proportion of the total response values for province 25, which is Tibet. As seen below, filtered just for Tibet for question l2409, 17/19 responses are invalid. Because water quality for Tibet also isn’t included, we’re forced to remove it from this analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict</span><span class="p">[</span><span class="n">cgss_strict</span><span class="p">[</span><span class="s1">&#39;s41&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">25</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;l2409&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>s41</th>
      <th>l14d</th>
    </tr>
    <tr>
      <th>l2409</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-3.0</th>
      <td>17</td>
      <td>17</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The response value of 8 refers to “cannot choose”, so for now, let’s drop those (it may be important later)</p>
<p>Let’s drop the two problmatic values -3 and -2, and 8, group by province again, and calculate the mean.</p>
</div>
</div>
<div class="section" id="if-i-filter-out-8-then-ningxia-province-get-s-taken-out-find-a-fix">
<h2><strong>If I filter out 8, then Ningxia province get’s taken out… find a fix</strong><a class="headerlink" href="#if-i-filter-out-8-then-ningxia-province-get-s-taken-out-find-a-fix" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_strict_mean</span> <span class="o">=</span> <span class="n">cgss_strict</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,],)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="merge-data">
<h3>Merge Data<a class="headerlink" href="#merge-data" title="Permalink to this headline">¶</a></h3>
<p>The following merges the <code class="docutils literal notranslate"><span class="pre">wqir_mean</span></code> values with the <code class="docutils literal notranslate"><span class="pre">provinces</span></code> dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">wqir_mean</span><span class="p">,</span> <span class="n">provinces</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;province&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Add water quality mean (per province) to each individual row:</p>
<p>Then, the <code class="docutils literal notranslate"><span class="pre">cgss_strict_clean</span></code> values are merged in. (I didn’t know how to do this in one step)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span><span class="n">cgss_strict_mean</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Quick check to see if there are visible trends…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">merged</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;score&#39;, ylabel=&#39;l14d&#39;&gt;
</pre></div>
</div>
<img alt="_images/thesis_analysis_85_1.png" src="_images/thesis_analysis_85_1.png" />
</div>
</div>
<hr class="docutils" />
<p>Now, let’s do this with the larger <code class="docutils literal notranslate"><span class="pre">cgss_important</span></code> dataframe:</p>
<p><em>Trying to get a df with values as index and frequency per question (column), but can’t…</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_part_l</span> <span class="o">=</span> <span class="n">cgss_important</span><span class="p">[</span><span class="n">part_l</span><span class="p">]</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cgss_part_l</span><span class="p">:</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">cgss_part_l</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Create the mean of all values from <code class="docutils literal notranslate"><span class="pre">cgss_important</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_imp_mean</span> <span class="o">=</span> <span class="n">cgss_important</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Merge with water quality and provinces:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">merge</span><span class="p">,</span><span class="n">cgss_imp_mean</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>Play around with some correlations:</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">cgss_important</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_mean</span> <span class="o">=</span> <span class="n">merged_imp</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot, first set the theme</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">font</span><span class="o">=</span><span class="s1">&#39;AR PL UMing CN&#39;</span><span class="p">,</span>
    <span class="n">font_scale</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">corr</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;BrBG&#39;</span><span class="p">,</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/will/anaconda3/lib/python3.8/site-packages/matplotlib/backends/backend_agg.py:238: RuntimeWarning: Glyph 8722 missing from current font.
  font.set_text(s, 0.0, flags=flags)
/home/will/anaconda3/lib/python3.8/site-packages/matplotlib/backends/backend_agg.py:201: RuntimeWarning: Glyph 8722 missing from current font.
  font.set_text(s, 0, flags=flags)
</pre></div>
</div>
<img alt="_images/thesis_analysis_99_1.png" src="_images/thesis_analysis_99_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure1</span> <span class="o">=</span> <span class="n">corr_hm</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_mean_hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">corr_mean</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;BrBG&#39;</span><span class="p">,</span>
    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/thesis_analysis_101_0.png" src="_images/thesis_analysis_101_0.png" />
</div>
</div>
<p>Check quickly for a .37 correlation (haven’t filtered out 8 value responses yet)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">font_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;gist_earth&quot;</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">merged_imp</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;score&#39;, ylabel=&#39;l14d&#39;&gt;
</pre></div>
</div>
<img alt="_images/thesis_analysis_104_1.png" src="_images/thesis_analysis_104_1.png" />
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="individual-data-analysis">
<h2>Individual Data Analysis<a class="headerlink" href="#individual-data-analysis" title="Permalink to this headline">¶</a></h2>
<p>This section adds mean water quality scores per province to each individual response of the <code class="docutils literal notranslate"><span class="pre">cgss</span></code> dataframe, thus analysis with more statistical significance can be done.</p>
<p>First, take only the s41 codes and wq mean scores from the <code class="docutils literal notranslate"><span class="pre">merge</span></code> dataframe, then add the water quality <code class="docutils literal notranslate"><span class="pre">score</span></code> to the main <code class="docutils literal notranslate"><span class="pre">cgss</span></code> dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wq</span> <span class="o">=</span> <span class="n">merge</span><span class="p">[[</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">]]</span>
<span class="n">cgss_wq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">cgss</span><span class="p">,</span><span class="n">wq</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This analysis will first be done on the <code class="docutils literal notranslate"><span class="pre">important</span></code> columns, from above:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cgss_wq_imp</span> <span class="o">=</span> <span class="n">cgss_wq</span><span class="p">[</span><span class="n">important_questions</span><span class="p">]</span>
<span class="n">cgss_wq_imp_clean</span> <span class="o">=</span> <span class="n">cgss_wq_imp</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Filter out negative values and unknown (‘8’)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wq_imp_clean</span> <span class="o">=</span> <span class="n">cgss_wq_imp_clean</span><span class="p">[</span>
    <span class="p">(</span><span class="n">cgss_wq_imp_clean</span><span class="o">.</span><span class="n">l14d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> 
     <span class="o">&amp;</span> <span class="p">(</span><span class="n">cgss_wq_imp_clean</span><span class="o">.</span><span class="n">l14d</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">)</span> 
     <span class="o">&amp;</span> <span class="p">(</span><span class="n">cgss_wq_imp_clean</span><span class="o">.</span><span class="n">l2409</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> 
     <span class="c1"># (cgss_wq_imp_clean.l2409 &lt; 3)</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clean_prov</span> <span class="o">=</span> <span class="n">wq_imp_clean</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maov</span> <span class="o">=</span> <span class="n">MANOVA</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s1">&#39;l14d + l2409 ~ s41 + score&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">wq_imp_clean</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">maov</span><span class="o">.</span><span class="n">mv_test</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                   Multivariate linear model
===============================================================
                                                               
---------------------------------------------------------------
       Intercept        Value  Num DF   Den DF  F Value  Pr &gt; F
---------------------------------------------------------------
          Wilks&#39; lambda 0.6818 2.0000 1975.0000 460.8016 0.0000
         Pillai&#39;s trace 0.3182 2.0000 1975.0000 460.8016 0.0000
 Hotelling-Lawley trace 0.4666 2.0000 1975.0000 460.8016 0.0000
    Roy&#39;s greatest root 0.4666 2.0000 1975.0000 460.8016 0.0000
---------------------------------------------------------------
                                                               
---------------------------------------------------------------
           s41           Value  Num DF   Den DF  F Value Pr &gt; F
---------------------------------------------------------------
           Wilks&#39; lambda 0.9985 2.0000 1975.0000  1.4759 0.2288
          Pillai&#39;s trace 0.0015 2.0000 1975.0000  1.4759 0.2288
  Hotelling-Lawley trace 0.0015 2.0000 1975.0000  1.4759 0.2288
     Roy&#39;s greatest root 0.0015 2.0000 1975.0000  1.4759 0.2288
---------------------------------------------------------------
                                                               
---------------------------------------------------------------
          score          Value  Num DF   Den DF  F Value Pr &gt; F
---------------------------------------------------------------
           Wilks&#39; lambda 0.9948 2.0000 1975.0000  5.1269 0.0060
          Pillai&#39;s trace 0.0052 2.0000 1975.0000  5.1269 0.0060
  Hotelling-Lawley trace 0.0052 2.0000 1975.0000  5.1269 0.0060
     Roy&#39;s greatest root 0.0052 2.0000 1975.0000  5.1269 0.0060
===============================================================
</pre></div>
</div>
</div>
</div>
<p>Conduct OLS regression with l14d dependent on gender, age (year) and income:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols_perception</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;l14d ~ score + a2 + a3a + a7a&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">wq_imp_clean</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ols_perception</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   l14d   R-squared:                       0.029
Model:                            OLS   Adj. R-squared:                  0.027
Method:                 Least Squares   F-statistic:                     14.85
Date:                Mon, 01 Feb 2021   Prob (F-statistic):           5.83e-12
Time:                        10:07:56   Log-Likelihood:                -2475.7
No. Observations:                1979   AIC:                             4961.
Df Residuals:                    1974   BIC:                             4989.
Df Model:                           4                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.8522      2.501     -0.341      0.733      -5.757       4.053
score         -0.0105      0.004     -2.461      0.014      -0.019      -0.002
a2            -0.0565      0.039     -1.465      0.143      -0.132       0.019
a3a            0.0018      0.001      1.414      0.157      -0.001       0.004
a7a           -0.0433      0.007     -6.638      0.000      -0.056      -0.031
==============================================================================
Omnibus:                       71.499   Durbin-Watson:                   1.867
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               78.462
Skew:                           0.482   Prob(JB):                     9.17e-18
Kurtosis:                       3.148   Cond. No.                     2.58e+05
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.58e+05. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<p><em>Think of a way to run the ols for knowledge without the l2409 = 8 values</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ols_knowledge</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="s1">&#39;l2409 ~ s41 + score + a2 + a3a + a7a + a91&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">wq_imp_clean</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ols_knowledge</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  l2409   R-squared:                       0.032
Model:                            OLS   Adj. R-squared:                  0.029
Method:                 Least Squares   F-statistic:                     12.86
Date:                Mon, 01 Feb 2021   Prob (F-statistic):           2.49e-12
Time:                        10:07:56   Log-Likelihood:                -4853.2
No. Observations:                1979   AIC:                             9718.
Df Residuals:                    1973   BIC:                             9752.
Df Model:                           5                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      1.9669      1.666      1.181      0.238      -1.301       5.234
s41            0.0069      0.008      0.918      0.359      -0.008       0.022
score          0.0166      0.015      1.104      0.270      -0.013       0.046
a2             0.4507      0.128      3.512      0.000       0.199       0.702
a3a           -0.0020      0.004     -0.467      0.640      -0.010       0.006
a7a           -0.1263      0.022     -5.778      0.000      -0.169      -0.083
a91            3.9339      3.332      1.181      0.238      -2.601      10.469
==============================================================================
Omnibus:                      501.667   Durbin-Watson:                   1.803
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              356.819
Skew:                          -0.933   Prob(JB):                     3.29e-78
Kurtosis:                       2.082   Cond. No.                     1.97e+19
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 1.96e-29. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
</pre></div>
</div>
</div>
</div>
<div class="section" id="initial-findings">
<h3>Initial Findings<a class="headerlink" href="#initial-findings" title="Permalink to this headline">¶</a></h3>
<p>With P&gt;|t| ~0.05 or less (0.055), this can be argued that an increased wq score (worse) leads to an decreased number for l14d (perceived to be more harmful)</p>
<p>The higher the education (a7a increases), the l14d number goes down (the perceived severity increases)</p>
<p>(The coef is negative for both, which indicates a negative relation/correlation)</p>
<p><strong>Keep in <code class="docutils literal notranslate"><span class="pre">l2409</span></code> unsure (8) since it increases observations and therefore statistical power (.02 vs .055)</strong></p>
<p>Thus: Water quality (score) is correlated with perception (l14d) &amp; education (a7a) is correlated to perception, Also (not shown) education is coorelated with wq knowledge (l2409), but score is not correlated with wq knowledge.</p>
<div class="section" id="test-for-divergence">
<h4>Test for divergence<a class="headerlink" href="#test-for-divergence" title="Permalink to this headline">¶</a></h4>
<p>Seeing if there’s a correlation between the difference between perception and score, and another variable.</p>
<p>Import main data, groupby and take mean…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tst</span> <span class="o">=</span> <span class="n">wq_imp_clean</span><span class="p">[[</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;s41&#39;</span><span class="p">,</span><span class="s1">&#39;l14d&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;s41&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">tst</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score</th>
      <th>l14d</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>31.000000</td>
      <td>31.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>16.130482</td>
      <td>2.205446</td>
    </tr>
    <tr>
      <th>std</th>
      <td>5.089124</td>
      <td>0.248531</td>
    </tr>
    <tr>
      <th>min</th>
      <td>6.901250</td>
      <td>1.736842</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>11.835313</td>
      <td>2.034139</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>16.965556</td>
      <td>2.140625</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>20.685417</td>
      <td>2.374687</td>
    </tr>
    <tr>
      <th>max</th>
      <td>23.630000</td>
      <td>2.909091</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Normalize the data (0-1) using code I found <a class="reference external" href="https://stackoverflow.com/questions/26414913/normalize-columns-of-pandas-data-frame">here</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">tst</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Make new column with the difference between the score and perception. Perception number goes up as perceived severity goes down. Score goes up as water quality gets worse.</p>
<p>Diff increases when the two are more different (positive if poor wq and severe perception, negative if good wq and good perception)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;l14d&#39;</span><span class="p">]</span>
<span class="n">test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score</th>
      <th>l14d</th>
      <th>diff</th>
    </tr>
    <tr>
      <th>s41</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>0.905628</td>
      <td>0.644261</td>
      <td>0.261367</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.487542</td>
      <td>0.814145</td>
      <td>-0.326602</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.892122</td>
      <td>0.893750</td>
      <td>-0.001628</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>0.787135</td>
      <td>0.712963</td>
      <td>0.074172</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>0.842996</td>
      <td>0.756250</td>
      <td>0.086746</td>
    </tr>
    <tr>
      <th>6.0</th>
      <td>0.424702</td>
      <td>0.845221</td>
      <td>-0.420518</td>
    </tr>
    <tr>
      <th>7.0</th>
      <td>1.000000</td>
      <td>0.687500</td>
      <td>0.312500</td>
    </tr>
    <tr>
      <th>8.0</th>
      <td>0.758781</td>
      <td>1.000000</td>
      <td>-0.241219</td>
    </tr>
    <tr>
      <th>9.0</th>
      <td>0.718472</td>
      <td>0.675223</td>
      <td>0.043249</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>0.925045</td>
      <td>0.800293</td>
      <td>0.124752</td>
    </tr>
    <tr>
      <th>11.0</th>
      <td>0.986458</td>
      <td>0.717134</td>
      <td>0.269324</td>
    </tr>
    <tr>
      <th>12.0</th>
      <td>0.770973</td>
      <td>0.793423</td>
      <td>-0.022450</td>
    </tr>
    <tr>
      <th>13.0</th>
      <td>0.565897</td>
      <td>0.820565</td>
      <td>-0.254668</td>
    </tr>
    <tr>
      <th>14.0</th>
      <td>0.480909</td>
      <td>0.710417</td>
      <td>-0.229507</td>
    </tr>
    <tr>
      <th>15.0</th>
      <td>0.777369</td>
      <td>0.698471</td>
      <td>0.078898</td>
    </tr>
    <tr>
      <th>16.0</th>
      <td>0.463317</td>
      <td>0.779851</td>
      <td>-0.316534</td>
    </tr>
    <tr>
      <th>17.0</th>
      <td>0.978956</td>
      <td>0.723060</td>
      <td>0.255896</td>
    </tr>
    <tr>
      <th>18.0</th>
      <td>0.717967</td>
      <td>0.818452</td>
      <td>-0.100486</td>
    </tr>
    <tr>
      <th>19.0</th>
      <td>0.546686</td>
      <td>0.704566</td>
      <td>-0.157880</td>
    </tr>
    <tr>
      <th>20.0</th>
      <td>0.968324</td>
      <td>0.597039</td>
      <td>0.371285</td>
    </tr>
    <tr>
      <th>21.0</th>
      <td>0.596649</td>
      <td>0.844747</td>
      <td>-0.248098</td>
    </tr>
    <tr>
      <th>22.0</th>
      <td>0.421770</td>
      <td>0.759577</td>
      <td>-0.337806</td>
    </tr>
    <tr>
      <th>23.0</th>
      <td>0.514177</td>
      <td>0.687500</td>
      <td>-0.173323</td>
    </tr>
    <tr>
      <th>24.0</th>
      <td>0.517751</td>
      <td>0.735840</td>
      <td>-0.218089</td>
    </tr>
    <tr>
      <th>25.0</th>
      <td>0.332023</td>
      <td>0.687500</td>
      <td>-0.355477</td>
    </tr>
    <tr>
      <th>26.0</th>
      <td>0.399727</td>
      <td>0.700000</td>
      <td>-0.300273</td>
    </tr>
    <tr>
      <th>27.0</th>
      <td>0.930839</td>
      <td>0.752976</td>
      <td>0.177862</td>
    </tr>
    <tr>
      <th>28.0</th>
      <td>0.585696</td>
      <td>0.870117</td>
      <td>-0.284421</td>
    </tr>
    <tr>
      <th>29.0</th>
      <td>0.712823</td>
      <td>0.877467</td>
      <td>-0.164644</td>
    </tr>
    <tr>
      <th>30.0</th>
      <td>0.292055</td>
      <td>0.687500</td>
      <td>-0.395445</td>
    </tr>
    <tr>
      <th>31.0</th>
      <td>0.858654</td>
      <td>0.705981</td>
      <td>0.152673</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Plot difference vs wq score</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;score&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;l14d&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7f7bdb423610&gt;
</pre></div>
</div>
<img alt="_images/thesis_analysis_128_1.png" src="_images/thesis_analysis_128_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">clean_prov</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;l14d&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;s41&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x7f7bdaca43d0&gt;
</pre></div>
</div>
<img alt="_images/thesis_analysis_129_1.png" src="_images/thesis_analysis_129_1.png" />
</div>
</div>
<p>Interesting! ^</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python38564bitbaseconda7d6f1c93fcf44d42a10d5ebc0f2d36ee",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python38564bitbaseconda7d6f1c93fcf44d42a10d5ebc0f2d36ee'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="methodology.html" title="previous page">Methodology</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>